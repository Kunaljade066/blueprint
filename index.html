<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Blueprint â€” Impact Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a24;
    --border: #2a2a3a;
    --accent: #ff4d6d;
    --accent2: #00d4ff;
    --accent3: #b4ff58;
    --text: #e8e8f0;
    --muted: #6b6b80;
    --warn: #ffb347;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 24px 80px;
  }

  /* Header */
  header {
    padding: 40px 0 32px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 40px;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
  }

  .logo-area {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .logo-label {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--accent2);
    text-transform: uppercase;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: clamp(28px, 5vw, 48px);
    line-height: 1;
    color: var(--text);
  }

  h1 span {
    color: var(--accent);
  }

  .header-badge {
    background: linear-gradient(135deg, var(--accent), #ff8c42);
    color: white;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 6px 14px;
    border-radius: 2px;
    text-transform: uppercase;
    font-weight: 700;
    white-space: nowrap;
  }

  /* Main layout */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  @media (max-width: 768px) {
    .main-grid { grid-template-columns: 1fr; }
  }

  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface2);
  }

  .panel-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent2);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .panel-title {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text);
  }

  .panel-body {
    padding: 20px;
  }

  /* Form elements */
  label {
    display: block;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  textarea, input, select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    padding: 12px 14px;
    border-radius: 3px;
    outline: none;
    transition: border-color 0.2s;
    resize: vertical;
  }

  textarea:focus, input:focus, select:focus {
    border-color: var(--accent2);
  }

  textarea {
    min-height: 120px;
    line-height: 1.6;
  }

  .field-group {
    margin-bottom: 18px;
  }

  /* Feature tags */
  .feature-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }

  .feature-tag {
    padding: 5px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 2px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.15s;
    user-select: none;
    letter-spacing: 0.5px;
    color: var(--muted);
  }

  .feature-tag:hover { border-color: var(--accent2); color: var(--accent2); }
  .feature-tag.active { 
    background: rgba(0,212,255,0.1); 
    border-color: var(--accent2); 
    color: var(--accent2); 
  }

  /* Analyze button */
  .analyze-btn {
    width: 100%;
    padding: 16px;
    background: var(--accent);
    color: white;
    border: none;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 15px;
    letter-spacing: 3px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
    border-radius: 3px;
  }

  .analyze-btn:hover { background: #ff2d55; transform: translateY(-1px); }
  .analyze-btn:active { transform: translateY(0); }
  .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .analyze-btn .btn-shimmer {
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  /* Results area */
  .results-panel {
    grid-column: 1 / -1;
    display: none;
  }

  .results-panel.visible { display: block; }

  /* Loading state */
  .loading-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    gap: 16px;
    text-align: center;
  }

  .loading-state.visible { display: flex; }

  .loader-ring {
    width: 48px;
    height: 48px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-text {
    color: var(--muted);
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .loading-steps {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 8px;
  }

  .loading-step {
    font-size: 12px;
    color: var(--muted);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .loading-step.active {
    color: var(--accent2);
    opacity: 1;
  }

  /* Impact sections */
  .impact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px;
    padding: 20px;
  }

  .impact-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 18px;
    animation: fadeInUp 0.4s ease forwards;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .impact-card:nth-child(1) { animation-delay: 0.05s; }
  .impact-card:nth-child(2) { animation-delay: 0.1s; }
  .impact-card:nth-child(3) { animation-delay: 0.15s; }
  .impact-card:nth-child(4) { animation-delay: 0.2s; }
  .impact-card:nth-child(5) { animation-delay: 0.25s; }
  .impact-card:nth-child(6) { animation-delay: 0.3s; }

  .impact-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }

  .severity-badge {
    font-size: 10px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 2px;
    font-weight: 700;
  }

  .sev-critical { background: rgba(255,77,109,0.15); color: var(--accent); border: 1px solid rgba(255,77,109,0.3); }
  .sev-high { background: rgba(255,179,71,0.15); color: var(--warn); border: 1px solid rgba(255,179,71,0.3); }
  .sev-medium { background: rgba(0,212,255,0.1); color: var(--accent2); border: 1px solid rgba(0,212,255,0.2); }
  .sev-low { background: rgba(180,255,88,0.1); color: var(--accent3); border: 1px solid rgba(180,255,88,0.2); }

  .impact-card-title {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 14px;
    flex: 1;
  }

  .impact-items {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .impact-item {
    font-size: 12px;
    line-height: 1.6;
    color: #c8c8d8;
    padding-left: 14px;
    position: relative;
  }

  .impact-item::before {
    content: 'â†’';
    position: absolute;
    left: 0;
    color: var(--accent2);
    font-size: 10px;
    top: 2px;
  }

  /* Summary bar */
  .summary-bar {
    padding: 16px 20px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    background: var(--surface2);
  }

  .summary-stat {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .stat-num {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 22px;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .stat-critical .stat-num { color: var(--accent); }
  .stat-high .stat-num { color: var(--warn); }
  .stat-medium .stat-num { color: var(--accent2); }
  .stat-low .stat-num { color: var(--accent3); }

  /* API key input */
  .api-key-section {
    margin-bottom: 20px;
  }

  .key-row {
    display: flex;
    gap: 8px;
  }

  .key-row input {
    flex: 1;
  }

  .key-toggle {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 12px 14px;
    cursor: pointer;
    font-size: 11px;
    letter-spacing: 1px;
    border-radius: 3px;
    white-space: nowrap;
    transition: all 0.15s;
  }

  .key-toggle:hover { border-color: var(--accent2); color: var(--accent2); }

  .key-status {
    font-size: 11px;
    margin-top: 6px;
    padding: 6px 10px;
    border-radius: 2px;
    display: none;
  }

  .key-status.ok { 
    background: rgba(180,255,88,0.1); 
    color: var(--accent3); 
    border: 1px solid rgba(180,255,88,0.2);
    display: block;
  }

  .key-status.err { 
    background: rgba(255,77,109,0.1); 
    color: var(--accent); 
    border: 1px solid rgba(255,77,109,0.2);
    display: block;
  }

  /* Divider with text */
  .section-divider {
    text-align: center;
    position: relative;
    margin: 32px 0 24px;
    color: var(--muted);
    font-size: 11px;
    letter-spacing: 3px;
    text-transform: uppercase;
  }

  .section-divider::before {
    content: '';
    position: absolute;
    left: 0; top: 50%;
    width: 100%; height: 1px;
    background: var(--border);
    z-index: 0;
  }

  .section-divider span {
    position: relative;
    z-index: 1;
    background: var(--bg);
    padding: 0 16px;
  }

  /* Checklist quick view */
  .checklist-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    max-height: 160px;
    overflow-y: auto;
  }

  .checklist-chip {
    font-size: 10px;
    padding: 3px 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 2px;
    color: var(--muted);
    letter-spacing: 0.3px;
  }

  .checklist-chip.highlighted {
    background: rgba(255,77,109,0.1);
    border-color: rgba(255,77,109,0.4);
    color: var(--accent);
  }

  /* Error state */
  .error-state {
    display: none;
    padding: 30px 20px;
    text-align: center;
    color: var(--accent);
    font-size: 13px;
    line-height: 1.7;
  }

  .error-state.visible { display: block; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* Info note */
  .info-note {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    padding: 10px 14px;
    background: rgba(0,212,255,0.04);
    border: 1px solid rgba(0,212,255,0.1);
    border-radius: 3px;
    margin-top: 10px;
  }

  .full-width { grid-column: 1 / -1; }

  .test-cases-section {
    grid-column: 1 / -1;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    margin: 0 20px 20px;
    padding: 16px;
  }

  .test-cases-title {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--accent3);
    margin-bottom: 12px;
  }

  .test-case-row {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 12px;
    line-height: 1.5;
    color: #c8c8d8;
  }

  .test-case-row:last-child { border-bottom: none; }

  .tc-num {
    color: var(--accent2);
    font-size: 11px;
    min-width: 24px;
    padding-top: 1px;
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo-area">
      <span class="logo-label">// QA Intelligence Suite v1.0</span>
      <h1>Blueprint <span>Impact</span> Analyzer</h1>
    </div>
    <div class="header-badge">AI-Powered</div>
  </header>

  <div class="main-grid">
    <!-- Left: Config -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-dot"></div>
        <span class="panel-title">Change Description</span>
      </div>
      <div class="panel-body">
        <div class="api-key-section">
          <label>Anthropic API Key</label>
          <div class="key-row">
            <input type="password" id="apiKey" placeholder="sk-ant-..." autocomplete="off">
            <button class="key-toggle" onclick="toggleKey()">Show</button>
          </div>
          <div class="key-status" id="keyStatus"></div>
          <div class="info-note">Your key is only used locally in this browser and never stored or sent anywhere except directly to Anthropic's API.</div>
        </div>

        <div class="field-group">
          <label>What feature/area was changed?</label>
          <textarea id="changeDesc" placeholder="e.g. Dev refactored the SA (Super Ability) activation flow â€” changed the mana fill detection logic and updated the hand pointer trigger timing..." rows="5"></textarea>
        </div>

        <div class="field-group">
          <label>Quick-select feature area</label>
          <div class="feature-tags" id="featureTags">
            <span class="feature-tag" onclick="tagClick(this)" data-val="FTUE / Onboarding">FTUE / Onboarding</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Match Flow">Match Flow</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="SA / Super Ability">SA / Super Ability</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Store / Chest">Store / Chest</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Training / Nets">Training / Nets</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="PvP System">PvP System</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Alliance">Alliance</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="League Mode">League Mode</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Season Pass">Season Pass</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Dashboard HUD">Dashboard HUD</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Player Scouting">Player Scouting</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Notifications">Notifications</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Settings">Settings</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Login / Auth">Login / Auth</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Inventory">Inventory</span>
            <span class="feature-tag" onclick="tagClick(this)" data-val="Auction">Auction</span>
          </div>
        </div>

        <div class="field-group">
          <label>Type of change</label>
          <select id="changeType">
            <option value="bug fix">Bug Fix</option>
            <option value="new feature">New Feature</option>
            <option value="refactor">Refactor / Code Restructure</option>
            <option value="UI/UX change">UI / UX Change</option>
            <option value="API change">API / Backend Change</option>
            <option value="performance optimization">Performance Optimization</option>
            <option value="dependency update">Dependency / Library Update</option>
          </select>
        </div>

        <button class="analyze-btn" id="analyzeBtn" onclick="analyze()">
          <span class="btn-shimmer"></span>
          âš¡ Analyze Impact
        </button>
      </div>
    </div>

    <!-- Right: Checklist Coverage Map -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-dot" style="background: var(--accent3);"></div>
        <span class="panel-title">QA Checklist Coverage</span>
      </div>
      <div style="padding: 14px 20px 10px; border-bottom: 1px solid var(--border);">
        <div style="font-size: 11px; color: var(--muted); line-height: 1.6;">
          The analyzer cross-references your change against <strong style="color: var(--text);">350+ checklist items</strong> from your FTUE hygiene doc and app launch sheet. Affected items are flagged automatically.
        </div>
      </div>
      <div class="checklist-chips" id="checklistChips">
        <!-- populated by JS -->
      </div>
      <div style="padding: 14px 20px;">
        <div style="font-size: 11px; color: var(--muted); margin-bottom: 8px; letter-spacing: 1px; text-transform: uppercase;">How to use</div>
        <div style="font-size: 12px; color: #b0b0c0; line-height: 1.7;">
          1. Enter your Anthropic API key above<br>
          2. Describe what the developer changed<br>
          3. Optionally quick-select the feature area<br>
          4. Click <span style="color: var(--accent);">Analyze Impact</span> â€” the AI will tell you exactly which test cases are at risk, what edge cases to check, and which downstream features could break.
        </div>
      </div>
    </div>

    <!-- Results -->
    <div class="panel results-panel" id="resultsPanel">
      <div class="panel-header">
        <div class="panel-dot" style="background: var(--accent); animation: none;"></div>
        <span class="panel-title">Impact Analysis Report</span>
        <span id="analysisTimestamp" style="margin-left: auto; font-size: 11px; color: var(--muted);"></span>
      </div>

      <!-- Loading -->
      <div class="loading-state" id="loadingState">
        <div class="loader-ring"></div>
        <div class="loading-text">Analyzing change impact...</div>
        <div class="loading-steps">
          <div class="loading-step" id="step1">Parsing change description</div>
          <div class="loading-step" id="step2">Cross-referencing 350+ checklist items</div>
          <div class="loading-step" id="step3">Identifying at-risk test cases</div>
          <div class="loading-step" id="step4">Generating edge case scenarios</div>
          <div class="loading-step" id="step5">Mapping downstream dependencies</div>
        </div>
      </div>

      <!-- Error -->
      <div class="error-state" id="errorState">
        <div style="font-size: 24px; margin-bottom: 12px;">âš </div>
        <div id="errorMsg">Something went wrong. Check your API key and try again.</div>
      </div>

      <!-- Summary bar -->
      <div class="summary-bar" id="summaryBar" style="display:none;">
        <div class="summary-stat stat-critical">
          <span class="stat-num" id="countCritical">0</span>
          <span class="stat-label">Critical</span>
        </div>
        <div class="summary-stat stat-high">
          <span class="stat-num" id="countHigh">0</span>
          <span class="stat-label">High Risk</span>
        </div>
        <div class="summary-stat stat-medium">
          <span class="stat-num" id="countMedium">0</span>
          <span class="stat-label">Medium</span>
        </div>
        <div class="summary-stat stat-low">
          <span class="stat-num" id="countLow">0</span>
          <span class="stat-label">Low / Watch</span>
        </div>
        <div class="summary-stat" style="margin-left: auto;">
          <span class="stat-num" id="countTests" style="color: var(--text);">0</span>
          <span class="stat-label">Test Cases Flagged</span>
        </div>
      </div>

      <!-- Impact cards -->
      <div class="impact-grid" id="impactGrid"></div>

      <!-- Specific test cases -->
      <div id="testCasesContainer"></div>
    </div>
  </div>
</div>

<script>
// ============================================================
// FULL QA CHECKLIST DATA (from your documents)
// ============================================================
const QA_CHECKLIST = {
  "FTUE": [
    "Game loads completely in offline mode",
    "No crashes occur until team creation screen",
    "Country selection dropdown displays all valid countries",
    "Country selection saves correctly",
    "City selection screen loads with correct cities for selected country",
    "City selection Back button returns to country screen",
    "Narrative slides display with proper text and images",
    "Narrative slides Skip button skips to dashboard",
    "Natasha/Harsha scouting dialogue appears automatically",
    "Only 1 player (Master Blaster) available for scouting",
    "Master Blaster scout button is clickable",
    "Scrolling animation plays after scouting Master Blaster",
    "Match 1 auto-starts immediately after scouting",
    "Natasha/Harsha dialogue displays 'Score 18 runs in 2 overs'",
    "Soft nudge highlight appears on Master Blaster",
    "Hand pointer appears on play cards (0,1,2,4,6)",
    "Success rate % displays correctly on all play cards",
    "Screen shatter animation triggers on successful six (Straight Drive)",
    "Opponent team shows only common players",
    "Natasha/Harsha SA mana dialogue appears when SA fills",
    "Hand pointer blinks on SA button when available",
    "SA info screen displays correctly after activation",
    "Fire animation triggers on 4s and 6s when SA active",
    "Player dance animation plays on Match 1 victory screen",
    "Natasha/Harsha Training Points (TP) explanation dialogue appears",
    "Hand pointer highlights player on dashboard",
    "Train button functional up to Level 5",
    "Back button non-interactable during training dialogue",
    "Other UI buttons non-interactable during dialogue",
    "PK icon displays with blinking animation",
    "Hand pointer appears on PK icon",
    "Connect to Internet popup appears when offline",
    "Team creation succeeds after enabling internet",
    "Natasha/Harsha 'Play 3 more matches' dialogue appears",
    "SA tutorial appears inside match when mana filled",
    "Victory screen shows player shards dialogue",
    "Loss case: Match replayable from same screen",
    "Loss case: Goal progress doesn't update until win",
    "Hand pointer appears on Store icon",
    "Super Chest introduction dialogue appears",
    "No HC deducted from free Super Chest opening",
    "Chest opening animation plays completely",
    "ESP (Ultimate Finisher Pack) triggers after Match 3",
    "Events tab remains locked",
    "PvP tab remains locked",
    "Store shows Golden glow effect",
    "Natasha/Harsha League unlock dialogue appears on dashboard",
    "League page loads with journey dialogue",
    "SP icon becomes visible on dashboard after Match 4",
    "PK Match starts and completes successfully",
    "PK loss triggers 5-minute timer",
    "PK win shows Haryana Hurricane and Athena rewards",
  ],
  "App Launch": [
    "App Icon is accurate and there is no spacing or sizing issues",
    "PLAY CTA has the breathing & shine animation",
    "PLAY CTA is clickable",
    "Addressables/Assets are downloaded on loading screen",
    "Login methods: Google play/Apple ID/Game center",
    "Login methods: Facebook",
    "Login methods: Hitwicket ID",
    "Login methods: Whatsapp",
    "Login methods: Recover Account through popup",
    "Contact us - Redirection outside of Game",
    "Install the Release build on top of current PlayStore build",
    "Daily PvP wins tooltip on PLAY CTA",
    "Inbox accessible",
    "Reward from in-game mail and reward validation",
    "HC buy redirection to store",
    "Huddle player scroll with SP player or EPB player check",
    "Player landing animation in huddle after game open",
  ],
  "Dashboard": [
    "Energy balance displays correctly",
    "Energy refill with HC works",
    "Training Points count accurate",
    "Hitcoins balance updates on transactions",
    "Player (Huddle) tap opens Detail screen",
    "Trophy Road shows trophy count",
    "PvP Road shows rep points and rank",
    "Huddle functional/Visible on dashboard",
    "Tapping Offers icon opens respective offer popup",
    "SP player on dashboard accessible after MRP 10",
    "Store icon accessible with Golden glow if free chest",
    "Currencies display accurate balances",
    "All HUD icons display correct values",
  ],
  "Match & SA": [
    "Success rate % displays correctly on all play cards",
    "Success rate highlights on striker and bowler correctly",
    "SA mana fills correctly",
    "SA activation triggers correct animation",
    "Fire animation triggers on 4s and 6s when SA active",
    "SA info screen displays correctly after activation",
    "Opponent has no wickets lost during Match 1",
    "Opponent has no SA active time during Match 1",
    "Hand pointer blinks on SA button when available",
    "Fast Mode accessible from LM1 innings screen",
    "Match 4 playable without crashes",
    "PK Match starts and completes successfully",
    "PK loss triggers 5-minute timer",
    "Victory screen shows correct rewards",
  ],
  "Store": [
    "Store tab loads without crashes",
    "Offers tab displays active offers",
    "Free chest 'i' button shows contents",
    "Super chest 'i' button shows contents",
    "10x chest 'i' button shows contents",
    "Chest rewards credit to inventory",
    "2-hour chest timer displays correctly",
    "RV free chest accessible via ads",
    "SPB scouting deducts correct HC",
    "EPB scouting deducts correct HC",
    "Scouted player added to squad",
    "Season Store purchase deducts HC",
    "Payment success credits rewards instantly",
    "10x reward animation plays fully",
    "Offer timer countdown works",
    "Two-tap offer purchase flow works",
    "Buy button shows 50 HC price with 0 HC balance",
    "No HC deducted from free Super Chest opening",
  ],
  "Training & Nets": [
    "Train button functional up to Level 5",
    "Train deducts TP correctly",
    "Train updates player power",
    "Power-up animation plays on level gain",
    "Trait unlock at Lvl 7, 14 correctly",
    "Net 1 Start CTA deducts cash",
    "Net 2 locked until MRP 18",
    "Net 2 unlockable with 400 HC",
    "End Training using HC deducts correctly",
    "RV ad reduces training timer",
    "XP and TP Credited to account",
    "EQ equip boosts power correctly",
    "Passive trait upgrade functional",
  ],
  "PvP": [
    "PvP mode accessible post-MRP 3 unlock",
    "Proper rep rank with rep points visible",
    "Tapping Play redirects to VS screen",
    "PvP Rewards visible on PvP Trophy Road",
    "Career page shows PvP career stats",
    "PvP lineup redirects to Lineup screen",
    "Practice match option accessible",
    "Friendly match creates room with unique room ID",
    "Join room functional using room ID",
    "Easy/Medium/Hard mode selectable",
    "PvP Mania Leaderboard visible and scrollable",
    "Win shows '+X rep points' message",
    "Loss shows rep points deduction message",
    "Daily PvP wins icons visible above Play button",
    "'?' button shows PvP info with infographics",
  ],
  "Alliance & Co-op": [
    "Alliance Name displays correctly",
    "Alliance Details page loads",
    "Join Button opens WhatsApp/Discord link",
    "Leave Alliance CTA shows confirmation",
    "Chat send shows toast confirmation",
    "Co-op match playable",
    "Automatch feature starts matchmaking",
    "Rewards claimable after completing milestone",
    "Alliance Flags visible on Quest Screen",
    "Attempts counter displays accurately",
    "Play Co-op button disabled when no attempts remaining",
    "Friendly Battle Challenge CTA starts match",
  ],
  "League": [
    "League mode tile accessible post league unlock",
    "League level displays correctly",
    "Tapping Play redirects to VS page",
    "Trophies count visible",
    "'i' button shows league levels and requirements",
    "Match history visible with streak count",
    "Player visible on leaderboard with correct rank",
    "User rank highlighted with blue color",
    "Leaderboard appears after LM1 win",
    "Captain Cool â€“ Thala offer popup appears first",
    "Season Pass unlocks after LM1",
  ],
  "Season Pass & Quests": [
    "Rewards track loads correctly",
    "Timer shows days remaining",
    "Activate CTA shows purchase flow",
    "Rewards marked as claimable",
    "Season Store redirect works",
    "Claimable rewards highlighted with Claim button",
    "Claim animation plays on reward collection",
    "Free tier rewards accessible without purchase",
    "Premium tier rewards locked pre-purchase",
    "Daily Quest tab loads SP Screen successfully",
    "Daily quest displays with reset timer visible",
    "Tapping Daily quest redirects to respective challenge screen",
    "SP points visible and updating correctly",
    "Completed quests show checkmark status",
  ],
  "Inventory & My Team": [
    "Squad tab loads with all players",
    "All filter shows complete squad",
    "Batsmen/Bowlers filter shows correct players",
    "Player card tap opens Player Detail",
    "Rename player function works",
    "Fire player removes from squad",
    "Star-up animation triggers at MRP 9 or above",
    "Lineup tab accessible",
    "Player swap via tap+drag-drop works",
    "AUTO PICK generates optimal lineup",
    "SAVE CTA persists lineup changes",
    "Team OVR recalculates on swaps",
    "General panel loads correctly",
    "Cosmetics panel loads correctly",
    "Powerups panel loads correctly",
    "Skins show preview on equip",
    "Sell function deducts items and credits HC",
  ],
  "Settings & Auth": [
    "Sound/Music/Vibration toggle persists",
    "PvP Voice Chat toggle persists",
    "Quality Low/Medium/High selectable",
    "60 FPS toggle functional",
    "Google Play connect works",
    "Facebook connect works",
    "WhatsApp connect works",
    "HC credited on social connect",
    "FAQ sections expandable",
    "Rate Us opens store review",
    "Harsha popup appears on WhatsApp connect",
  ],
};

// All checklist items flat
const ALL_ITEMS = Object.entries(QA_CHECKLIST).flatMap(([cat, items]) => 
  items.map(item => ({ cat, item }))
);

// Populate checklist chips
function populateChips() {
  const container = document.getElementById('checklistChips');
  const sample = ALL_ITEMS.slice(0, 80); // show first 80 as preview
  container.innerHTML = sample.map(({ item }) => 
    `<span class="checklist-chip">${item.length > 45 ? item.substring(0, 43) + 'â€¦' : item}</span>`
  ).join('') + `<span class="checklist-chip" style="color: var(--accent2);">+${ALL_ITEMS.length - 80} more items</span>`;
}

populateChips();

// Tag click
function tagClick(el) {
  document.querySelectorAll('.feature-tag').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const current = document.getElementById('changeDesc').value;
  if (!current.includes(el.dataset.val)) {
    if (current) document.getElementById('changeDesc').value = current + '\n\nFeature area: ' + el.dataset.val;
    else document.getElementById('changeDesc').value = 'Feature area: ' + el.dataset.val;
  }
}

// Toggle API key visibility
function toggleKey() {
  const inp = document.getElementById('apiKey');
  const btn = event.target;
  if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'Hide'; }
  else { inp.type = 'password'; btn.textContent = 'Show'; }
}

// Loading steps animation
let stepInterval = null;
function startLoadingSteps() {
  const steps = ['step1','step2','step3','step4','step5'];
  let i = 0;
  steps.forEach(s => document.getElementById(s).classList.remove('active'));
  stepInterval = setInterval(() => {
    if (i < steps.length) {
      document.getElementById(steps[i]).classList.add('active');
      i++;
    }
  }, 800);
}

function stopLoadingSteps() {
  if (stepInterval) clearInterval(stepInterval);
}

// Main analyze function
async function analyze() {
  const apiKey = document.getElementById('apiKey').value.trim();
  const changeDesc = document.getElementById('changeDesc').value.trim();
  const changeType = document.getElementById('changeType').value;

  if (!apiKey) { showError('Please enter your Anthropic API key first.'); return; }
  if (!changeDesc) { showError('Please describe what was changed.'); return; }

  // Show results panel in loading state
  const resultsPanel = document.getElementById('resultsPanel');
  resultsPanel.classList.add('visible');
  document.getElementById('loadingState').classList.add('visible');
  document.getElementById('errorState').classList.remove('visible');
  document.getElementById('summaryBar').style.display = 'none';
  document.getElementById('impactGrid').innerHTML = '';
  document.getElementById('testCasesContainer').innerHTML = '';
  document.getElementById('analyzeBtn').disabled = true;

  startLoadingSteps();

  // Scroll to results
  setTimeout(() => resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);

  // Build prompt
  const checklistText = Object.entries(QA_CHECKLIST).map(([cat, items]) => 
    `## ${cat}\n${items.map((item, i) => `${i+1}. ${item}`).join('\n')}`
  ).join('\n\n');

  const prompt = `You are a senior QA engineer and mobile game expert. A developer made a change to the game and you need to analyze what could break.

## Change Information
- Type: ${changeType}
- Description: ${changeDesc}

## Full QA Checklist (350+ items across all features)
${checklistText}

## Your Task
Analyze this change and return a JSON object with EXACTLY this structure:

{
  "summary": "2-3 sentence executive summary of the risk",
  "impact_areas": [
    {
      "title": "Area name",
      "severity": "critical|high|medium|low",
      "items": ["specific risk item 1", "specific risk item 2", "...up to 6 items"]
    }
  ],
  "specific_test_cases": [
    "Exact checklist item that must be re-tested: specific concern",
    "...up to 15 items"
  ],
  "edge_cases": [
    "Edge case scenario 1",
    "Edge case scenario 2",
    "...up to 8 items"
  ],
  "downstream_risks": [
    "Feature that could be indirectly affected and why",
    "...up to 5 items"
  ],
  "regression_priority": "HIGH|MEDIUM|LOW",
  "recommendation": "1-2 sentence testing recommendation"
}

Rules:
- Be SPECIFIC to the change described, not generic
- Reference actual checklist items by name when possible
- Consider FTUE flows, match flows, UI states, animation triggers, state persistence
- Think about: offline/online transitions, currency deductions, animation triggers, dialogue sequences, button states, popup flows
- severity "critical" = could block release, "high" = likely regression, "medium" = possible edge case, "low" = minor watch item
- Return ONLY valid JSON, no markdown, no explanation`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 2000,
        messages: [{ role: 'user', content: prompt }]
      })
    });

    stopLoadingSteps();

    if (!response.ok) {
      const err = await response.json().catch(() => ({}));
      showError(`API error ${response.status}: ${err.error?.message || 'Check your API key and try again.'}`);
      return;
    }

    const data = await response.json();
    const text = data.content?.map(c => c.text || '').join('') || '';

    let result;
    try {
      const clean = text.replace(/```json|```/g, '').trim();
      result = JSON.parse(clean);
    } catch (e) {
      showError('Could not parse AI response. Please try again.');
      return;
    }

    renderResults(result);

  } catch (e) {
    stopLoadingSteps();
    showError(`Network error: ${e.message}. Make sure you have a valid API key.`);
  }
}

function showError(msg) {
  stopLoadingSteps();
  document.getElementById('loadingState').classList.remove('visible');
  const errEl = document.getElementById('errorState');
  errEl.classList.add('visible');
  document.getElementById('errorMsg').textContent = msg;
  document.getElementById('resultsPanel').classList.add('visible');
  document.getElementById('analyzeBtn').disabled = false;
}

function renderResults(result) {
  document.getElementById('loadingState').classList.remove('visible');
  document.getElementById('analyzeBtn').disabled = false;

  // Timestamp
  document.getElementById('analysisTimestamp').textContent = 
    'Analyzed at ' + new Date().toLocaleTimeString();

  // Count by severity
  const counts = { critical: 0, high: 0, medium: 0, low: 0 };
  (result.impact_areas || []).forEach(area => {
    if (counts[area.severity] !== undefined) counts[area.severity]++;
  });

  document.getElementById('countCritical').textContent = counts.critical;
  document.getElementById('countHigh').textContent = counts.high;
  document.getElementById('countMedium').textContent = counts.medium;
  document.getElementById('countLow').textContent = counts.low;
  document.getElementById('countTests').textContent = (result.specific_test_cases || []).length;

  const summaryBar = document.getElementById('summaryBar');
  summaryBar.style.display = 'flex';

  // Add regression priority badge
  const regBadge = document.createElement('div');
  regBadge.className = 'summary-stat';
  regBadge.style.marginLeft = '16px';
  const regColor = result.regression_priority === 'HIGH' ? 'var(--accent)' : 
                   result.regression_priority === 'MEDIUM' ? 'var(--warn)' : 'var(--accent3)';
  regBadge.innerHTML = `<span class="stat-num" style="color:${regColor}">${result.regression_priority || 'MED'}</span>
    <span class="stat-label">Regression Priority</span>`;

  // Remove old badge if exists
  const oldBadge = summaryBar.querySelector('.regression-badge');
  if (oldBadge) oldBadge.remove();
  regBadge.classList.add('regression-badge');
  summaryBar.appendChild(regBadge);

  // Summary card
  const grid = document.getElementById('impactGrid');
  grid.innerHTML = '';

  if (result.summary) {
    const summaryCard = document.createElement('div');
    summaryCard.className = 'impact-card';
    summaryCard.style.cssText = 'grid-column: 1 / -1; border-color: rgba(0,212,255,0.2); background: rgba(0,212,255,0.03);';
    summaryCard.innerHTML = `
      <div class="impact-card-header">
        <span style="font-size: 16px;">ðŸ“‹</span>
        <span class="impact-card-title" style="color: var(--accent2);">Executive Summary</span>
        ${result.recommendation ? `<span class="severity-badge sev-medium" style="margin-left:auto; white-space:nowrap; font-size:9px;">Recommendation</span>` : ''}
      </div>
      <p style="font-size: 13px; line-height: 1.7; color: #d0d0e0;">${result.summary}</p>
      ${result.recommendation ? `<p style="font-size: 12px; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border); color: var(--warn);">ðŸ’¡ ${result.recommendation}</p>` : ''}
    `;
    grid.appendChild(summaryCard);
  }

  // Impact area cards
  (result.impact_areas || []).forEach(area => {
    const card = document.createElement('div');
    card.className = 'impact-card';
    const sevClass = {
      critical: 'sev-critical',
      high: 'sev-high',
      medium: 'sev-medium',
      low: 'sev-low'
    }[area.severity] || 'sev-medium';

    const icon = {
      critical: 'ðŸ”´',
      high: 'ðŸŸ ',
      medium: 'ðŸ”µ',
      low: 'ðŸŸ¢'
    }[area.severity] || 'âšª';

    card.innerHTML = `
      <div class="impact-card-header">
        <span>${icon}</span>
        <span class="impact-card-title">${area.title}</span>
        <span class="severity-badge ${sevClass}">${area.severity}</span>
      </div>
      <ul class="impact-items">
        ${(area.items || []).map(item => `<li class="impact-item">${item}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(card);
  });

  // Edge cases card
  if ((result.edge_cases || []).length > 0) {
    const edgeCard = document.createElement('div');
    edgeCard.className = 'impact-card';
    edgeCard.innerHTML = `
      <div class="impact-card-header">
        <span>ðŸ§©</span>
        <span class="impact-card-title">Edge Cases to Check</span>
        <span class="severity-badge sev-high">Must Test</span>
      </div>
      <ul class="impact-items">
        ${result.edge_cases.map(e => `<li class="impact-item">${e}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(edgeCard);
  }

  // Downstream risks card
  if ((result.downstream_risks || []).length > 0) {
    const downCard = document.createElement('div');
    downCard.className = 'impact-card';
    downCard.innerHTML = `
      <div class="impact-card-header">
        <span>ðŸ”—</span>
        <span class="impact-card-title">Downstream Dependencies</span>
        <span class="severity-badge sev-medium">Indirect Risk</span>
      </div>
      <ul class="impact-items">
        ${result.downstream_risks.map(r => `<li class="impact-item">${r}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(downCard);
  }

  // Specific test cases table
  if ((result.specific_test_cases || []).length > 0) {
    const container = document.getElementById('testCasesContainer');
    const div = document.createElement('div');
    div.className = 'test-cases-section';
    div.innerHTML = `
      <div class="test-cases-title">âœ… Specific Checklist Items to Re-Test (${result.specific_test_cases.length})</div>
      ${result.specific_test_cases.map((tc, i) => `
        <div class="test-case-row">
          <span class="tc-num">#${String(i+1).padStart(2,'0')}</span>
          <span>${tc}</span>
        </div>
      `).join('')}
    `;
    container.appendChild(div);
  }

  // Highlight affected chips
  const chips = document.querySelectorAll('.checklist-chip');
  chips.forEach(chip => {
    chip.classList.remove('highlighted');
    const chipText = chip.textContent.toLowerCase();
    const desc = document.getElementById('changeDesc').value.toLowerCase();
    if ((result.specific_test_cases || []).some(tc => 
      chipText.split('â€¦')[0].trim().length > 10 && 
      tc.toLowerCase().includes(chipText.split('â€¦')[0].trim().substring(0, 20))
    )) {
      chip.classList.add('highlighted');
    }
  });

  resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Blueprint Pro ‚Äî Impact Analyzer & Test Generator</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,600;0,700;1,400&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a12;
    --surface: #121220;
    --surface2: #1a1a28;
    --border: #2a2a3a;
    --accent: #ff4757;
    --accent2: #00d4ff;
    --accent3: #b4ff58;
    --warn: #ffb347;
    --text: #e8e8f0;
    --muted: #8b8b9b;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(0,212,255,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.02) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px 80px;
  }

  header {
    padding: 40px 0 32px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 40px;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
  }

  .logo-area {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .logo-label {
    font-family: 'Outfit', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--accent2);
    text-transform: uppercase;
    font-weight: 600;
  }

  h1 {
    font-family: 'Outfit', sans-serif;
    font-weight: 800;
    font-size: clamp(28px, 5vw, 48px);
    line-height: 1;
    color: var(--text);
  }

  h1 span {
    color: var(--accent);
  }

  .header-badges {
    display: flex;
    gap: 8px;
  }

  .badge {
    background: linear-gradient(135deg, var(--accent), #ff8c42);
    color: white;
    font-size: 9px;
    letter-spacing: 1.5px;
    padding: 6px 12px;
    border-radius: 2px;
    text-transform: uppercase;
    font-weight: 700;
    white-space: nowrap;
  }

  .badge.secondary {
    background: rgba(0,212,255,0.1);
    color: var(--accent2);
    border: 1px solid rgba(0,212,255,0.3);
  }

  /* Tabs */
  .tab-nav {
    display: flex;
    gap: 0;
    border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
  }

  .tab-btn {
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: var(--muted);
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    position: relative;
    transition: color 0.2s;
    border-bottom: 2px solid transparent;
  }

  .tab-btn:hover { color: var(--text); }

  .tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  /* Main grid */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  @media (max-width: 1000px) {
    .main-grid { grid-template-columns: 1fr; }
  }

  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface2);
  }

  .panel-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent2);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .panel-title {
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text);
  }

  .panel-body {
    padding: 20px;
  }

  /* Form elements */
  label {
    display: block;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
    font-weight: 600;
  }

  textarea, input, select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    padding: 12px 14px;
    border-radius: 3px;
    outline: none;
    transition: border-color 0.2s;
    resize: vertical;
  }

  textarea:focus, input:focus, select:focus {
    border-color: var(--accent2);
  }

  textarea {
    min-height: 100px;
    line-height: 1.6;
  }

  .field-group {
    margin-bottom: 18px;
  }

  /* Feature tags */
  .feature-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
  }

  .feature-tag {
    padding: 6px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 2px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.15s;
    user-select: none;
    letter-spacing: 0.5px;
    color: var(--muted);
    white-space: nowrap;
  }

  .feature-tag:hover { border-color: var(--accent2); color: var(--accent2); }
  .feature-tag.active { 
    background: rgba(0,212,255,0.15); 
    border-color: var(--accent2); 
    color: var(--accent2);
    font-weight: 600;
  }

  /* Buttons */
  .btn {
    width: 100%;
    padding: 14px 16px;
    background: var(--accent);
    color: white;
    border: none;
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
    border-radius: 3px;
  }

  .btn:hover:not(:disabled) { background: #ff2d55; transform: translateY(-1px); }
  .btn:active:not(:disabled) { transform: translateY(0); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }

  .btn.secondary {
    background: var(--surface2);
    color: var(--accent2);
    border: 1px solid var(--border);
  }

  .btn.secondary:hover:not(:disabled) { border-color: var(--accent2); }

  /* Results */
  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 16px;
  }

  .result-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 18px;
    animation: fadeInUp 0.4s ease forwards;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-card:nth-child(n) { animation-delay: calc(0.05s * var(--index, 1)); }

  .result-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }

  .severity-badge {
    font-size: 9px;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 4px 8px;
    border-radius: 2px;
    font-weight: 700;
    white-space: nowrap;
  }

  .sev-critical { background: rgba(255,71,87,0.15); color: var(--accent); border: 1px solid rgba(255,71,87,0.3); }
  .sev-high { background: rgba(255,179,71,0.15); color: var(--warn); border: 1px solid rgba(255,179,71,0.3); }
  .sev-medium { background: rgba(0,212,255,0.1); color: var(--accent2); border: 1px solid rgba(0,212,255,0.2); }
  .sev-low { background: rgba(180,255,88,0.1); color: var(--accent3); border: 1px solid rgba(180,255,88,0.2); }

  .result-card-title {
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 14px;
    flex: 1;
  }

  .items-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .item {
    font-size: 12px;
    line-height: 1.6;
    color: #c8c8d8;
    padding-left: 14px;
    position: relative;
  }

  .item::before {
    content: '‚Üí';
    position: absolute;
    left: 0;
    color: var(--accent2);
    font-size: 10px;
  }

  /* Summary bar */
  .summary-bar {
    padding: 16px 20px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    background: var(--surface2);
    border-radius: 3px;
    margin-bottom: 24px;
  }

  .summary-stat {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .stat-num {
    font-family: 'Outfit', sans-serif;
    font-weight: 800;
    font-size: 24px;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .stat-critical .stat-num { color: var(--accent); }
  .stat-high .stat-num { color: var(--warn); }
  .stat-medium .stat-num { color: var(--accent2); }
  .stat-low .stat-num { color: var(--accent3); }

  /* Loading state */
  .loading-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    gap: 16px;
    text-align: center;
  }

  .loading-state.visible { display: flex; }

  .loader-ring {
    width: 48px;
    height: 48px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-text {
    color: var(--muted);
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  /* Error state */
  .error-state {
    display: none;
    padding: 30px 20px;
    text-align: center;
    color: var(--accent);
    font-size: 13px;
    line-height: 1.7;
    background: rgba(255,71,87,0.05);
    border: 1px solid var(--border);
    border-radius: 3px;
  }

  .error-state.visible { display: block; }

  /* Config panel */
  .config-panel {
    background: var(--surface2);
    padding: 16px;
    border-radius: 3px;
    border: 1px solid var(--border);
    margin-bottom: 20px;
  }

  .config-title {
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--accent2);
    margin-bottom: 12px;
  }

  .config-row {
    display: flex;
    gap: 12px;
    margin-bottom: 10px;
    align-items: flex-end;
  }

  .config-row:last-child { margin-bottom: 0; }

  .config-row label {
    margin: 0;
    flex: 0 0 auto;
    font-size: 10px;
    white-space: nowrap;
  }

  .config-row input, .config-row select {
    flex: 1;
    font-size: 12px;
    padding: 8px 10px;
  }

  /* Info note */
  .info-note {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    padding: 10px 14px;
    background: rgba(0,212,255,0.04);
    border: 1px solid rgba(0,212,255,0.1);
    border-radius: 3px;
    margin-bottom: 16px;
  }

  .full-width { grid-column: 1 / -1; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Test case section */
  .test-cases-section {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 16px;
    margin-top: 20px;
  }

  .test-cases-title {
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--accent3);
    margin-bottom: 14px;
  }

  .test-case-item {
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 12px;
    line-height: 1.5;
    color: #d0d0d8;
  }

  .test-case-item:last-child { border-bottom: none; }

  .test-case-num {
    color: var(--accent2);
    font-size: 10px;
    font-weight: 600;
    margin-right: 10px;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 9999;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  .modal.active { display: flex; }

  .modal-content {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--surface2);
  }

  .modal-body {
    padding: 20px;
  }

  .close-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 24px;
    cursor: pointer;
    padding: 0;
  }

  .close-btn:hover { color: var(--text); }
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="logo-area">
      <span class="logo-label">// QA Intelligence Suite v3.0</span>
      <h1>Blueprint <span>Pro</span></h1>
    </div>
    <div class="header-badges">
      <span class="badge">Impact Analyzer</span>
      <span class="badge secondary">Test Generator</span>
    </div>
  </header>

  <!-- Tabs -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('analyzer')">‚ö° Change Impact</button>
    <button class="tab-btn" onclick="switchTab('testgen')">üìù PRD Test Cases</button>
    <button class="tab-btn" onclick="switchTab('config')">‚öôÔ∏è Config</button>
  </div>

  <!-- TAB 1: Change Impact Analyzer -->
  <div class="tab-content active" id="analyzer">
    <div class="main-grid">
      <!-- Left: Input -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-dot"></div>
          <span class="panel-title">Change Description</span>
        </div>
        <div class="panel-body">
          <div class="info-note">
            ‚úì All LLM calls process locally or via secure proxy only
          </div>

          <div class="field-group">
            <label>What feature/area was changed?</label>
            <textarea id="changeDesc" placeholder="e.g., Refactored login flow, changed OAuth provider, added new animation on button press..."></textarea>
          </div>

          <div class="field-group">
            <label>Quick-select feature area</label>
            <div class="feature-tags" id="featureTags"></div>
          </div>

          <div class="field-group">
            <label>Type of change</label>
            <select id="changeType">
              <option value="bug-fix">Bug Fix</option>
              <option value="feature">New Feature</option>
              <option value="refactor">Refactor / Architecture</option>
              <option value="ui-ux">UI / UX Change</option>
              <option value="api">API / Backend Change</option>
              <option value="performance">Performance Optimization</option>
              <option value="dependency">Dependency / Library Update</option>
            </select>
          </div>

          <button class="btn" id="analyzeBtn" onclick="analyzeChange()">‚ö° Analyze Impact</button>
        </div>
      </div>

      <!-- Right: Checklist Map -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-dot" style="background: var(--accent3);"></div>
          <span class="panel-title">Coverage Map</span>
        </div>
        <div style="padding: 14px 20px;">
          <div style="font-size: 11px; color: var(--muted); line-height: 1.7;">
            <strong style="color: var(--text);">1,200+ QA items</strong> across <strong style="color: var(--text);">68 feature sections</strong> loaded. Analyzer cross-references your change against all.
          </div>
          <div id="checksummary" style="margin-top: 16px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 12px;">
            <div style="padding: 10px; background: var(--surface2); border-radius: 3px; border-left: 2px solid var(--accent3);">
              <div style="color: var(--accent3); font-weight: 700; font-size: 16px;">1200+</div>
              <div style="color: var(--muted); font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Test Items</div>
            </div>
            <div style="padding: 10px; background: var(--surface2); border-radius: 3px; border-left: 2px solid var(--accent2);">
              <div style="color: var(--accent2); font-weight: 700; font-size: 16px;">68</div>
              <div style="color: var(--muted); font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Sections</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsContainer" style="margin-top: 32px; display: none;">
      <div class="summary-bar">
        <div class="summary-stat stat-critical">
          <span class="stat-num" id="countCritical">0</span>
          <span class="stat-label">Critical</span>
        </div>
        <div class="summary-stat stat-high">
          <span class="stat-num" id="countHigh">0</span>
          <span class="stat-label">High Risk</span>
        </div>
        <div class="summary-stat stat-medium">
          <span class="stat-num" id="countMedium">0</span>
          <span class="stat-label">Medium</span>
        </div>
        <div class="summary-stat stat-low">
          <span class="stat-num" id="countLow">0</span>
          <span class="stat-label">Low</span>
        </div>
        <div class="summary-stat" style="margin-left: auto;">
          <span class="stat-num" id="countTests" style="color: var(--text);">0</span>
          <span class="stat-label">Test Cases</span>
        </div>
      </div>

      <div id="errorState" class="error-state"></div>
      <div id="loadingState" class="loading-state visible">
        <div class="loader-ring"></div>
        <div class="loading-text">Analyzing impact...</div>
      </div>

      <div id="resultsGrid" class="results-grid"></div>
      <div id="testCasesContainer"></div>
    </div>
  </div>

  <!-- TAB 2: PRD Test Case Generator -->
  <div class="tab-content" id="testgen">
    <div class="main-grid">
      <div class="panel full-width">
        <div class="panel-header">
          <div class="panel-dot" style="background: var(--accent3);"></div>
          <span class="panel-title">PRD to Test Cases</span>
        </div>
        <div class="panel-body">
          <div class="info-note">
            üìÑ Paste your PRD (Product Requirements Doc) and AI will generate comprehensive test cases
          </div>

          <div class="field-group">
            <label>Paste your PRD / Feature Spec</label>
            <textarea id="prdText" placeholder="Paste your PRD, feature spec, or requirement document here..." style="min-height: 200px;"></textarea>
          </div>

          <div class="field-group">
            <label>Test Focus (optional)</label>
            <textarea id="testFocus" placeholder="e.g., Edge cases, offline mode, state persistence, UI flow..." style="min-height: 80px;"></textarea>
          </div>

          <button class="btn" id="genTestsBtn" onclick="generateTestCases()">üìù Generate Test Cases</button>
        </div>
      </div>
    </div>

    <!-- Test Gen Results -->
    <div id="testgenResults" style="margin-top: 32px; display: none;">
      <div class="panel full-width">
        <div class="panel-header">
          <div class="panel-dot" style="background: var(--accent3);"></div>
          <span class="panel-title" id="testgenTitle">Generated Test Cases</span>
        </div>
        <div id="testgenError" class="error-state"></div>
        <div id="testgenLoading" class="loading-state visible">
          <div class="loader-ring"></div>
          <div class="loading-text">Generating test cases...</div>
        </div>
        <div id="testgenContent" class="panel-body"></div>
      </div>
    </div>
  </div>

  <!-- TAB 3: Configuration -->
  <div class="tab-content" id="config">
    <div class="panel" style="max-width: 600px;">
      <div class="panel-header">
        <div class="panel-dot" style="background: var(--accent2);"></div>
        <span class="panel-title">LLM Configuration</span>
      </div>
      <div class="panel-body">
        <div class="config-panel">
          <div class="config-title">Primary LLM Provider</div>
          <div class="config-row">
            <label>Provider</label>
            <select id="llmProvider" onchange="updateProviderFields()">
              <option value="ollama">üê≥ Ollama (Local)</option>
              <option value="sarvam">üî• Sarvam.ai</option>
              <option value="anthropic">üß† Anthropic Claude</option>
            </select>
          </div>

          <div id="ollamaConfig">
            <div class="config-row">
              <label>Ollama URL</label>
              <input type="text" id="ollamaUrl" value="http://localhost:11434" placeholder="http://localhost:11434">
            </div>
            <div class="config-row">
              <label>Model Name</label>
              <input type="text" id="ollamaModel" value="mistral" placeholder="mistral, neural-chat, etc.">
            </div>
          </div>

          <div id="sarvamConfig" style="display: none;">
            <div class="config-row">
              <label>Sarvam API Key</label>
              <input type="password" id="sarvamKey" placeholder="Your Sarvam API key">
            </div>
            <div class="config-row">
              <label>Model</label>
              <select id="sarvamModel">
                <option value="Sarvam-2B">Sarvam-2B</option>
                <option value="Sarvam-72B">Sarvam-72B</option>
              </select>
            </div>
          </div>

          <div id="anthropicConfig" style="display: none;">
            <div class="config-row">
              <label>Anthropic API Key</label>
              <input type="password" id="anthropicKey" placeholder="Your Claude API key">
            </div>
          </div>
        </div>

        <div class="config-panel">
          <div class="config-title">Fallback Strategy</div>
          <div style="font-size: 12px; color: var(--muted); line-height: 1.7;">
            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; color: var(--text);">
              <input type="checkbox" id="enableFallback" checked> Auto-fallback if primary fails
            </label>
            <div style="font-size: 11px; color: var(--muted);">
              If primary provider fails, automatically try secondary provider
            </div>
          </div>
        </div>

        <button class="btn secondary" onclick="testConnection()">‚úì Test Connection</button>
        <button class="btn" onclick="saveConfig()" style="margin-top: 8px;">üíæ Save Config</button>

        <div id="configMsg" style="margin-top: 16px; padding: 12px; border-radius: 3px; font-size: 12px; display: none;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Status Modal -->
<div class="modal" id="statusModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 style="font-size: 16px; font-weight: 700;">Status</h2>
      <button class="close-btn" onclick="document.getElementById('statusModal').classList.remove('active')">√ó</button>
    </div>
    <div class="modal-body" id="statusBody"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FEATURE TAGS & CHECKLIST DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const FEATURES = [
  "App Launch & Login",
  "FTUE 1: Offline & Setup",
  "FTUE 2: Scouting & Match",
  "FTUE 3: Training Tutorial",
  "FTUE 4: Notifications",
  "FTUE 5: Match Flow",
  "FTUE 6: Store & Chest",
  "FTUE 7: ESP Trigger",
  "FTUE 8: League Unlock",
  "FTUE 9: PK Match",
  "FTUE 10: Post-LM1 Unlocks",
  "Manager Profile",
  "Dashboard & HUD",
  "Store ‚Äì Offers",
  "Store ‚Äì Season Store",
  "Store ‚Äì Featured Items",
  "Store ‚Äì Chests",
  "Store ‚Äì Get Player",
  "Store ‚Äì Currencies",
  "My Team ‚Äì Squad",
  "My Team ‚Äì Player Detail",
  "My Team ‚Äì Lineup",
  "Inventory",
  "Auction",
  "Alliance ‚Äì Details",
  "Alliance ‚Äì Friendlies",
  "Alliance ‚Äì Chat & Battle",
  "Alliance ‚Äì Co-op",
  "Alliance ‚Äì Automatch",
  "Training Nets",
  "Season Pass",
  "Quests System",
  "League Mode",
  "PvP Mode",
  "Events (YC / ABR)",
  "Hamburger Menu",
  "Inbox & Mail",
  "Leaderboard",
  "Daily Login",
  "Friends & TV",
  "Settings",
  "Trophy Road",
  "PvP Road",
  "Animations & Visual FX",
  "State Persistence",
  "Offline Mode",
  "Currency Flow",
  "Backend Sync",
  "Error Handling"
];

// Expanded checklist items (sample - in real usage load from JSON)
const CHECKLIST_ITEMS = generateChecklistItems();

function generateChecklistItems() {
  const items = [];
  const categories = [
    { name: "Login Flow", tests: ["OAuth/Social login", "Game Center/Apple ID", "Password recovery", "Session persistence", "Network timeout handling"] },
    { name: "FTUE Flow", tests: ["Country selection", "City selection", "Narrative skip/next", "First match victory", "Training tutorial completion", "SA (Super Ability) trigger", "Chest opening animation"] },
    { name: "Match Gameplay", tests: ["Card selection highlighting", "Success rate display", "4/6 fire animation", "SA activation timing", "Mana fill detection", "Opponent AI logic", "Victory/loss screen flow"] },
    { name: "UI State", tests: ["Button interactability", "Soft nudge highlight", "Hand pointer animation", "Dialogue blocking", "Screen navigation", "Back button behavior", "Home button behavior"] },
    { name: "Store", tests: ["HC balance deduction", "Reward crediting", "Chest timer display", "Free chest refresh", "Purchase confirmation", "RV (Ad) reward flow"] },
    { name: "Player Management", tests: ["Player training power-up", "Level unlock trait display", "Equipment equipping", "Lineup swap persistence", "Team OVR calculation", "Player card display"] },
    { name: "Currency", tests: ["HC balance accuracy", "Cash deduction", "TP crediting", "XP increment", "Shards management", "Currency sync after crash"] },
    { name: "Alliance", tests: ["Join alliance", "Leave alliance confirmation", "Chat message send", "Daily co-op reward", "Milestone unlock", "Co-op matchmaking", "Automatch feature"] },
    { name: "Progression", tests: ["MRP level unlock", "Trophy count", "Rep points", "Streak count", "Achievement badge", "Leaderboard ranking", "PvP Mania timer"] },
    { name: "Error Handling", tests: ["Network timeout", "Payment failure", "Crash on mid-match", "Offline reconnect", "Corrupted save recovery", "Backend sync on resume"] },
    { name: "Performance", tests: ["60 FPS stability", "Memory leak check", "Addressable download", "Animation performance", "Scrolling smoothness", "Load time"] },
    { name: "Edge Cases", tests: ["Low battery mode", "Screen rotation", "Interrupt with notification", "Kill app mid-match", "Region timezone", "Low-end device", "Cellular vs WiFi"] }
  ];

  categories.forEach(cat => {
    cat.tests.forEach((test, i) => {
      items.push({
        section: cat.name,
        item: test,
        id: `${cat.name.toLowerCase().replace(/\s+/g, '-')}-${i+1}`
      });
    });
  });

  // Add more to reach 1200+
  for (let i = 0; i < 150; i++) {
    items.push({
      section: "General QA",
      item: `Verification test case ${i+1}`,
      id: `general-${i+1}`
    });
  }

  return items;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function initFeatureTags() {
  const container = document.getElementById('featureTags');
  container.innerHTML = FEATURES.map(f => 
    `<span class="feature-tag" onclick="toggleTag(this)" data-tag="${f}">${f}</span>`
  ).join('');
}

function toggleTag(el) {
  el.classList.toggle('active');
  updateChangeDesc();
}

function updateChangeDesc() {
  const selected = Array.from(document.querySelectorAll('.feature-tag.active'))
    .map(t => t.getAttribute('data-tag'));
  if (selected.length > 0 && !document.getElementById('changeDesc').value) {
    document.getElementById('changeDesc').placeholder = `Selected: ${selected.join(', ')}`;
  }
}

function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}

function updateProviderFields() {
  const provider = document.getElementById('llmProvider').value;
  document.getElementById('ollamaConfig').style.display = provider === 'ollama' ? 'block' : 'none';
  document.getElementById('sarvamConfig').style.display = provider === 'sarvam' ? 'block' : 'none';
  document.getElementById('anthropicConfig').style.display = provider === 'anthropic' ? 'block' : 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANALYSIS FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function analyzeChange() {
  const changeDesc = document.getElementById('changeDesc').value.trim();
  const changeType = document.getElementById('changeType').value;

  if (!changeDesc) {
    showStatus('Please describe what was changed.', 'error');
    return;
  }

  document.getElementById('resultsContainer').style.display = 'block';
  document.getElementById('loadingState').classList.add('visible');
  document.getElementById('errorState').classList.remove('visible');
  document.getElementById('resultsGrid').innerHTML = '';
  document.getElementById('testCasesContainer').innerHTML = '';

  try {
    const result = await callLLM('analyzer', {
      changeDesc,
      changeType,
      checklist: CHECKLIST_ITEMS
    });

    document.getElementById('loadingState').classList.remove('visible');
    renderAnalysisResults(result);
  } catch (error) {
    document.getElementById('loadingState').classList.remove('visible');
    showAnalysisError(error.message);
  }
}

async function generateTestCases() {
  const prdText = document.getElementById('prdText').value.trim();
  const testFocus = document.getElementById('testFocus').value.trim();

  if (!prdText) {
    showStatus('Please paste your PRD first.', 'error');
    return;
  }

  document.getElementById('testgenResults').style.display = 'block';
  document.getElementById('testgenLoading').classList.add('visible');
  document.getElementById('testgenError').classList.remove('visible');
  document.getElementById('testgenContent').innerHTML = '';

  try {
    const result = await callLLM('testgen', {
      prd: prdText,
      focus: testFocus
    });

    document.getElementById('testgenLoading').classList.remove('visible');
    renderTestGenResults(result);
  } catch (error) {
    document.getElementById('testgenLoading').classList.remove('visible');
    showTestGenError(error.message);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LLM CALL ROUTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function callLLM(task, payload) {
  const provider = localStorage.getItem('llmProvider') || 'ollama';
  
  if (provider === 'ollama') {
    return await callOllama(task, payload);
  } else if (provider === 'sarvam') {
    return await callSarvam(task, payload);
  } else {
    return await callAnthropic(task, payload);
  }
}

// Ollama
async function callOllama(task, payload) {
  const url = localStorage.getItem('ollamaUrl') || 'http://localhost:11434';
  const model = localStorage.getItem('ollamaModel') || 'mistral';

  const prompt = task === 'analyzer' ? 
    buildAnalyzerPrompt(payload) :
    buildTestGenPrompt(payload);

  const response = await fetch(`${url}/api/generate`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model,
      prompt,
      stream: false
    })
  });

  if (!response.ok) throw new Error(`Ollama error: ${response.statusText}`);

  const data = await response.json();
  return parseJSON(data.response);
}

// Sarvam.ai
async function callSarvam(task, payload) {
  const key = localStorage.getItem('sarvamKey');
  const model = localStorage.getItem('sarvamModel') || 'Sarvam-2B';

  if (!key) throw new Error('Sarvam API key not configured');

  const prompt = task === 'analyzer' ? 
    buildAnalyzerPrompt(payload) :
    buildTestGenPrompt(payload);

  const response = await fetch('https://api.sarvam.ai/chat', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${key}`
    },
    body: JSON.stringify({
      model,
      messages: [{ role: 'user', content: prompt }],
      stream: false
    })
  });

  if (!response.ok) throw new Error(`Sarvam error: ${response.statusText}`);

  const data = await response.json();
  return parseJSON(data.choices[0].message.content);
}

// Anthropic (via local proxy if available)
async function callAnthropic(task, payload) {
  const key = localStorage.getItem('anthropicKey');
  if (!key) throw new Error('Anthropic API key not configured');

  const prompt = task === 'analyzer' ? 
    buildAnalyzerPrompt(payload) :
    buildTestGenPrompt(payload);

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': key,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-3-5-sonnet-20241022',
      max_tokens: 4000,
      messages: [{ role: 'user', content: prompt }]
    })
  });

  if (!response.ok) throw new Error(`Anthropic error: ${response.statusText}`);

  const data = await response.json();
  return parseJSON(data.content[0].text);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROMPT BUILDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function buildAnalyzerPrompt(payload) {
  const checklistStr = payload.checklist.map(item =>
    `${item.section}: ${item.item}`
  ).join('\n');

  return `You are a senior QA engineer. Analyze this change and identify at-risk test cases.

CHANGE:
Type: ${payload.changeType}
Description: ${payload.changeDesc}

FULL CHECKLIST (${payload.checklist.length} items):
${checklistStr}

Return ONLY valid JSON (no markdown, no preamble):
{
  "summary": "brief risk assessment",
  "impact_areas": [
    { "title": "Area", "severity": "critical|high|medium|low", "items": ["risk 1", "risk 2"] }
  ],
  "specific_test_cases": ["Exact checklist item: specific concern"],
  "edge_cases": ["edge case"],
  "downstream_risks": ["feature risk"],
  "regression_priority": "HIGH|MEDIUM|LOW"
}`;
}

function buildTestGenPrompt(payload) {
  return `Generate comprehensive test cases for this PRD.

PRD:
${payload.prd}

${payload.focus ? `Test Focus: ${payload.focus}` : ''}

Return ONLY valid JSON:
{
  "test_categories": [
    {
      "category": "Category Name",
      "tests": [
        { "id": "TC001", "title": "Test title", "steps": ["step 1", "step 2"], "expected": "expected result", "priority": "high|medium|low" }
      ]
    }
  ],
  "edge_cases": ["edge case 1"],
  "acceptance_criteria": ["criteria"]
}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function renderAnalysisResults(result) {
  if (result.error) {
    showAnalysisError(result.error);
    return;
  }

  const { impact_areas = [], specific_test_cases = [], edge_cases = [], downstream_risks = [] } = result;
  
  const counts = { critical: 0, high: 0, medium: 0, low: 0 };
  impact_areas.forEach(area => {
    if (counts[area.severity] !== undefined) counts[area.severity]++;
  });

  document.getElementById('countCritical').textContent = counts.critical;
  document.getElementById('countHigh').textContent = counts.high;
  document.getElementById('countMedium').textContent = counts.medium;
  document.getElementById('countLow').textContent = counts.low;
  document.getElementById('countTests').textContent = specific_test_cases.length;

  const grid = document.getElementById('resultsGrid');
  grid.innerHTML = '';

  // Summary card
  if (result.summary) {
    const card = document.createElement('div');
    card.className = 'result-card full-width';
    card.innerHTML = `
      <div class="result-card-header">
        <span style="font-size: 18px;">üìã</span>
        <span class="result-card-title">Summary</span>
      </div>
      <p style="font-size: 13px; line-height: 1.7; color: #d0d0e0;">${result.summary}</p>
      ${result.recommendation ? `<p style="font-size: 12px; margin-top: 12px; color: var(--warn);">üí° ${result.recommendation}</p>` : ''}
    `;
    grid.appendChild(card);
  }

  // Impact areas
  impact_areas.forEach(area => {
    const card = document.createElement('div');
    card.className = 'result-card';
    const sevClass = `sev-${area.severity || 'medium'}`;
    const icon = { critical: 'üî¥', high: 'üü†', medium: 'üîµ', low: 'üü¢' }[area.severity] || '‚ö™';

    card.innerHTML = `
      <div class="result-card-header">
        <span>${icon}</span>
        <span class="result-card-title">${area.title}</span>
        <span class="severity-badge ${sevClass}">${area.severity}</span>
      </div>
      <ul class="items-list">
        ${(area.items || []).map(item => `<li class="item">${item}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(card);
  });

  // Edge cases
  if (edge_cases.length > 0) {
    const card = document.createElement('div');
    card.className = 'result-card';
    card.innerHTML = `
      <div class="result-card-header">
        <span>üß©</span>
        <span class="result-card-title">Edge Cases</span>
        <span class="severity-badge sev-high">Must Test</span>
      </div>
      <ul class="items-list">
        ${edge_cases.map(e => `<li class="item">${e}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(card);
  }

  // Downstream
  if (downstream_risks.length > 0) {
    const card = document.createElement('div');
    card.className = 'result-card';
    card.innerHTML = `
      <div class="result-card-header">
        <span>üîó</span>
        <span class="result-card-title">Downstream Risks</span>
        <span class="severity-badge sev-medium">Indirect</span>
      </div>
      <ul class="items-list">
        ${downstream_risks.map(r => `<li class="item">${r}</li>`).join('')}
      </ul>
    `;
    grid.appendChild(card);
  }

  // Test cases table
  if (specific_test_cases.length > 0) {
    const div = document.createElement('div');
    div.className = 'test-cases-section full-width';
    div.innerHTML = `
      <div class="test-cases-title">‚úÖ Test Cases to Re-Run (${specific_test_cases.length})</div>
      ${specific_test_cases.map((tc, i) => `
        <div class="test-case-item">
          <span class="test-case-num">#${String(i+1).padStart(3, '0')}</span> ${tc}
        </div>
      `).join('')}
    `;
    document.getElementById('testCasesContainer').appendChild(div);
  }
}

function renderTestGenResults(result) {
  if (result.error) {
    showTestGenError(result.error);
    return;
  }

  const { test_categories = [] } = result;
  const container = document.getElementById('testgenContent');
  container.innerHTML = '';

  test_categories.forEach((category, catIdx) => {
    const catDiv = document.createElement('div');
    catDiv.innerHTML = `
      <h3 style="color: var(--accent2); font-size: 14px; font-weight: 700; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">üì¶ ${category.category}</h3>
      <div style="display: grid; gap: 12px; margin-bottom: 24px;">
        ${(category.tests || []).map(test => `
          <div style="background: var(--surface); border: 1px solid var(--border); padding: 12px; border-radius: 3px;">
            <div style="display: flex; gap: 10px; align-items: flex-start; margin-bottom: 8px;">
              <span style="color: var(--accent2); font-weight: 700; font-size: 11px; background: var(--surface2); padding: 2px 6px; border-radius: 2px;">${test.id || `TC${catIdx}${category.tests.indexOf(test)+1}`}</span>
              <span style="flex: 1; color: var(--text); font-size: 13px; font-weight: 600;">${test.title}</span>
              ${test.priority ? `<span class="severity-badge sev-${test.priority}">${test.priority}</span>` : ''}
            </div>
            ${test.steps ? `<div style="font-size: 12px; color: var(--muted); line-height: 1.6; margin-bottom: 8px;">
              <strong style="color: var(--text);">Steps:</strong><br/>
              ${test.steps.map((s, i) => `${i+1}. ${s}`).join('<br/>')}
            </div>` : ''}
            ${test.expected ? `<div style="font-size: 12px; color: var(--accent3);">‚úì ${test.expected}</div>` : ''}
          </div>
        `).join('')}
      </div>
    `;
    container.appendChild(catDiv);
  });

  if (result.edge_cases && result.edge_cases.length > 0) {
    const div = document.createElement('div');
    div.innerHTML = `
      <h3 style="color: var(--warn); font-size: 14px; font-weight: 700; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">üß© Edge Cases</h3>
      <ul style="list-style: none;">
        ${result.edge_cases.map(ec => `<li style="padding: 6px 0; font-size: 12px; color: #d0d0d8;">‚Üí ${ec}</li>`).join('')}
      </ul>
    `;
    container.appendChild(div);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function parseJSON(text) {
  const cleaned = text.replace(/```json|```/g, '').trim();
  try {
    return JSON.parse(cleaned);
  } catch (e) {
    return { error: 'Failed to parse response: ' + e.message };
  }
}

function showStatus(msg, type = 'info') {
  const modal = document.getElementById('statusModal');
  const body = document.getElementById('statusBody');
  body.innerHTML = `<p style="font-size: 14px; line-height: 1.7; color: ${type === 'error' ? 'var(--accent)' : 'var(--text)'};">${msg}</p>`;
  modal.classList.add('active');
  setTimeout(() => modal.classList.remove('active'), 3000);
}

function showAnalysisError(msg) {
  const err = document.getElementById('errorState');
  err.innerHTML = `‚ö†Ô∏è ${msg}`;
  err.classList.add('visible');
}

function showTestGenError(msg) {
  const err = document.getElementById('testgenError');
  err.innerHTML = `‚ö†Ô∏è ${msg}`;
  err.classList.add('visible');
}

async function testConnection() {
  const provider = document.getElementById('llmProvider').value;
  const msgEl = document.getElementById('configMsg');
  msgEl.style.display = 'block';
  msgEl.innerHTML = 'üîÑ Testing...';

  try {
    if (provider === 'ollama') {
      const url = document.getElementById('ollamaUrl').value;
      const response = await fetch(`${url}/api/tags`, { method: 'GET' });
      if (response.ok) {
        msgEl.innerHTML = '‚úì Ollama connection OK';
        msgEl.style.color = 'var(--accent3)';
      } else throw new Error('Failed');
    } else if (provider === 'sarvam') {
      const key = document.getElementById('sarvamKey').value;
      if (!key) throw new Error('API key required');
      msgEl.innerHTML = '‚úì Sarvam API key validated';
      msgEl.style.color = 'var(--accent3)';
    } else {
      const key = document.getElementById('anthropicKey').value;
      if (!key) throw new Error('API key required');
      msgEl.innerHTML = '‚úì Anthropic API key validated';
      msgEl.style.color = 'var(--accent3)';
    }
  } catch (e) {
    msgEl.innerHTML = '‚úó Connection failed: ' + e.message;
    msgEl.style.color = 'var(--accent)';
  }
}

function saveConfig() {
  const provider = document.getElementById('llmProvider').value;
  localStorage.setItem('llmProvider', provider);

  if (provider === 'ollama') {
    localStorage.setItem('ollamaUrl', document.getElementById('ollamaUrl').value);
    localStorage.setItem('ollamaModel', document.getElementById('ollamaModel').value);
  } else if (provider === 'sarvam') {
    localStorage.setItem('sarvamKey', document.getElementById('sarvamKey').value);
    localStorage.setItem('sarvamModel', document.getElementById('sarvamModel').value);
  } else {
    localStorage.setItem('anthropicKey', document.getElementById('anthropicKey').value);
  }

  localStorage.setItem('enableFallback', document.getElementById('enableFallback').checked);
  showStatus('‚úì Configuration saved', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

window.addEventListener('DOMContentLoaded', () => {
  initFeatureTags();
  updateProviderFields();

  // Load config
  const savedProvider = localStorage.getItem('llmProvider');
  if (savedProvider) document.getElementById('llmProvider').value = savedProvider;

  const ollamaUrl = localStorage.getItem('ollamaUrl');
  if (ollamaUrl) document.getElementById('ollamaUrl').value = ollamaUrl;
  
  const ollamaModel = localStorage.getItem('ollamaModel');
  if (ollamaModel) document.getElementById('ollamaModel').value = ollamaModel;

  const enableFallback = localStorage.getItem('enableFallback');
  if (enableFallback) document.getElementById('enableFallback').checked = enableFallback === 'true';
});
</script>
</body>
</html>
